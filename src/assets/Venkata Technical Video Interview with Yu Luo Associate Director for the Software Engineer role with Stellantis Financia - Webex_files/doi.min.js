"use strict";var doi={conf:{xhrHeader:{}},util:{},io:{},ticker:{liveCounter:0,actionRepo:[],onTick:function(a){this.actionRepo.push(a)},off:function(a){var b=this.actionRepo.indexOf(a);b>-1&&this.actionRepo.splice(b,1)},clear:function(){this.actionRepo=[]},trigger:function(){this.liveCounter++;for(var a in this.actionRepo)"function"==typeof this.actionRepo[a]&&this.actionRepo[a]()},intervalTick:function(){doi.ticker.trigger()}}};"object"==typeof global&&"object"==typeof module&&"undefined"==typeof window&&(doi.conf.inNodeMode=!0,global.window=global,window.XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest,module.exports=doi),window.doi=doi,window.setInterval(doi.ticker.intervalTick,100),function(){var a=window.doi.conf;a.abbrMapping={correlateID:"cid",product:"pd",telemetryVersion:"ver",timestamp:"ts",tsID:"tid",type:"t",values:"v"}}(),function(){function a(a){return"[object Array]"===Object.prototype.toString.call(a)}function b(a){return"[object Object]"===Object.prototype.toString.call(a)}function c(c){return!a(c)&&!b(c)}function d(a){var b=g.abbrMapping;for(var c in b)if(a===c)return b[c];return a}function e(b){if(c(b))return b;var f=a(b)?[]:{};for(var g in b)f[d(g)]=e(b[g]);return f}var f=window.doi,g=f.conf,h=f.util;h._keyAbbreviator=d,h.abbreviate=e}(),function(){var a=window.doi,b=a.conf;b.validation={AgentInfo:{required:["os","language","region","browser","timezone"],checkList:{os:["string"],language:["string"],region:["string"],browser:["string"],timezone:["string"],tzName:["string"],deviceModel:["string"],deviceInfo:["string"],SDKVersion:["string"],localIP:["string"],geoLocation:["string"]}},Info:{required:["category","userID","version"],checkList:{category:["string",["Conference","PT","Call","Room","Message","Session"]],userID:["string"],version:["string"],extVal:["object"]}},PageView:{required:["title","location"],checkList:{title:["string"],location:["string"],page:["string"],extVal:["object"]}},ScreenView:{required:["screenName"],checkList:{screenName:["string"],extVal:["object"]}},Action:{required:["category","action","uiSource"],checkList:{category:["string"],action:["string"],uiSource:["string"],label:["string"],value:["string"],interaction:["string",["mouse","voiceOver","keyboard","gesture","tap"]],trackingID:["string"],extVal:["object"]}},Event:{required:["category","event"],checkList:{category:["string"],event:["string"],label:["string"],value:["number"],trackingID:["string"],extVal:["object"]}},Timing:{required:["category","value"],checkList:{category:["string"],value:["number"],label:["string"],start:["string"],extVal:["object"]}},Counter:{required:["category","value"],checkList:{category:["string"],value:["number"],label:["string"],extVal:["object"]}},Quality:{required:["category","value"],checkList:{category:["string",["meeting","audio","video","share"]],value:["string"],label:["string"],mediaType:["string"],mediaSessionID:["string"],callLegTS:["string"],extVal:["object"]}},Exception:{required:["category","value"],checkList:{category:["string"],value:["string"],extVal:["object"]}},meetingclientevent:{required:["event"],checkList:{event:["object"]}}},b.TYPE={AGENTINFO:"AgentInfo",INFO:"Info",PAGEVIEW:"PageView",SCREENVIEW:"ScreenView",ACTION:"Action",EVENT:"Event",TIMING:"Timing",COUNTER:"Counter",QUALITY:"Quality",EXCEPTION:"Exception",CAEVENT:"meetingclientevent"}}(),function(){function a(a,b){return{pass:a,reason:b}}function b(a,b){return a.replace(/\{0\}/,b)}function c(a){for(var b in g.TYPE)if(g.TYPE[b]===a)return!0;return!1}function d(a,b){return b.indexOf(a)!==-1}function e(e){if(!e)return a(!1,i.OBJECT_MISSED);var f=e.values,h=e.type;if(!h)return a(!1,b(i.REQUIRED_PARAM_MISSED,"type"));if(!f)return a(!1,b(i.REQUIRED_PARAM_MISSED,"values"));if(!c(h))return a(!1,b(i.UNDEFINED_TYPE,h));var j=g.validation[h],k=j.required,l=j.checkList;for(var m in k)if(void 0===f[k[m]])return a(!1,b(i.REQUIRED_PARAM_MISSED,k[m]));for(var n in f){if(!l[n])return a(!1,b(i.UNACCEPTABLE_PARAM,n));if(typeof f[n]!==l[n][0])return a(!1,b(i.WRONG_VALUE_TYPE,'"'+n+'" should be '+l[n][0]));if(l[n][1]&&!d(f[n],l[n][1]))return a(!1,b(i.WRONG_VALUE,'"'+n+'" should be in array ['+l[n][1].join(", ")+"]"))}return a(!0,i.PASSED)}var f=window.doi,g=f.conf,h=f.util,i=g._VALIDATERESULT={PASSED:"Passed.",OBJECT_MISSED:"Validate object is missed.",REQUIRED_PARAM_MISSED:'Missed required parameter: "{0}".',UNDEFINED_TYPE:'"{0}" is not a expected type.',WRONG_VALUE_TYPE:"Wrong type of property: {0}.",WRONG_VALUE:"Wrong value of property: {0}.",UNACCEPTABLE_PARAM:'Parameter "{0}" is unexpected.'};h.validate=e}(),function(){function a(){return n.TID?n.TID:""}function b(a,b){n.xhrHeader[a]=b}function c(a){for(var b="0123456789abcdef",c="",d=0;d<a;d++)c+=b[16*Math.random()|0];return c}function d(){var a=c;return[a(8),a(4),a(4),a(4),a(12)].join("-")}function e(){var a=new Date,b=function(a,b){return("000"+a).slice(-b)},c=a.getTimezoneOffset(),d=-((c-c%60)/60*100+c%60),e=d>0?"+":"-";return[b(a.getFullYear(),4),"-",b(a.getMonth()+1,2),"-",b(a.getDate(),2),"T",b(a.getHours(),2),":",b(a.getMinutes(),2),":",b(a.getSeconds(),2),".",b(a.getMilliseconds(),3),e,b(Math.abs(d),4)].join("")}function f(){var a=q.splice(0,q.length);return"storage"===n.saveMode&&sessionStorage.removeItem("doiQueue"),n.retryCounter&&r.push.apply(r,a),JSON.stringify({telemetrics:a})}function g(a,b){var c=n.logger,d={type:a,ts:e(),tid:n.TID,cid:n.CID,pd:n.product,ver:"2.0",values:b},f=o.validate(d);f.pass||(c.warn("[doi warn]Data validate failed, reason: "+f.reason),c.warn(JSON.stringify(d))),n.retryCounter=n.retry,q.push(o.abbreviate(d)),"storage"===n.saveMode&&sessionStorage.setItem("doiQueue",JSON.stringify(q))}function h(){var a,b=n.logger,c=n.xhrHeader,d=!1,e=p.sendCounter++;if(!n.isInited)return void b.warn("[doi warn]doi initialed flag are false. (key:"+e+")");if(n.tickCounter=0,q.length){a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),a.open("POST",n.URL,!0);for(var g in c)a.setRequestHeader(g,c[g]);a.onreadystatechange=function(){4===this.readyState&&(200===this.status?(b.info("[doi info]doi send data success. (key:"+e+")"),n.retryCounter=n.retry):(b.warn("[doi warn]doi send data failed. (key:"+e+")"),n.retryCounter&&q.push.apply(q,r),this.abort()),r.splice(0,r.length),d=!0)},setTimeout(function(){d||(a.abort(),b.warn("[doi warn]doi send data failed, reason: timeout. (key:"+e+")"),d=!0)},6e4),b.info("[doi info]doi sending start. (key:"+e+")"),a.send(f()),n.retryCounter&&n.retryCounter--}}function i(){g(n.TYPE.PAGEVIEW,{title:window.document.title,location:window.location.href})}function j(){++n.tickCounter>=10*n.interval&&q.length&&h()}function k(a){function b(b,c){void 0!==a[b]?n[b]=a[b]:void 0!==n[b]?n[b]=n[b]:n[b]=c}var c=a&&a.logger?a.logger:n.logger||console;if(!a)return void c.error("[doi error]Parameter is empty.");if(a.TID=a.sessionID,a.CID=a.correlateID,a.noCache=a.immediateSend,a.retry||(a.retry=a.resendMatric===!0?3:a.resendMatric===!1?0:a.resendMatric),b("retry",3),b("product","unknown"),b("interval",300),b("TID",d()),b("CID",d()),b("noCache",!1),b("logger",c),n.retryCounter=n.retry,n.saveMode="memory","storage"===a.saveMode){if(window.sessionStorage){var e=sessionStorage.getItem("doiQueue");n.storageEnable=!0,e&&(q=p._QUEUE=JSON.parse(e)),n.saveMode="storage"}}else n.saveMode="memory"}function l(a){var c=a&&a.logger?a.logger:console;return window.XMLHttpRequest||window.ActiveXObject?a&&a.URL&&a.appID?(k(a),n.URL=a.URL,n.tickCounter=n.tickCounter||0,n.isInited=!0,b("appId",a.appID),b("Content-Type","text/plain"),b("ver","2.0"),m.ticker.onTick(j),void("object"==typeof window&&window.document&&window.location&&i())):void c.error("[doi error]Missed required parameters to initial doi."):void c.error("[doi error]Critical Err, require XMLHttpRequest support.")}var m=window.doi,n=m.conf,o=m.util,p=m.io,q=p._QUEUE=[],r=p._SENDING=[];p.sendCounter=1,p.init=l,p.setup=k,p.getSessionID=a,p.setHeader=b,p.save=g,p.send=h}(),function(){function a(a,b){var c=f.logger;if(!a)return c.error("[doi Error]Missed required parameter to start time trace."),0;var d=h.trackingId++;return i[d]={trackingId:d,startTime:+new Date,category:a,countdown:+b||120},d}function b(a){var b=f.logger,c=i[a];return a?void(a&&c&&delete i[a]):void b.error("[doi Error]Missed required parameter to stop time trace.")}function c(a){var b=f.logger,c=i[a];return a?void(a&&c&&(g.save(f.TYPE.TIMING,{category:c.category,value:+new Date-c.startTime}),delete i[a])):void b.error("[doi Error]Missed required parameter to send time trace.")}function d(){var a=h.anchor;for(var b in a)0===--a[b].countdown&&(g.save(f.TYPE.EXCEPTION,{category:a[b].category,value:"timeout"}),delete a[b])}var e=window.doi,f=e.conf,g=e.io,h={trackingId:1,anchor:{}},i=h.anchor;e.ticker.onTick(d),g.startTimeTrace=a,g.stopTimeTrace=b,g.sendTimeTrace=c}(),function(){var a=window.doi,b=a.io;a.setup=function(a){b.setup(a)},a.init=function(a){b.init(a)},a.getSessionID=function(){return b.getSessionID()},a.setHeader=function(a,c){b.setHeader(a,c)},a.sendInfo=function(b){a.send("Info",b,!1)},a.sendScreenView=function(b){a.send("ScreenView",b,!1)},a.sendAction=function(b){a.send("Action",b,!1)},a.sendEvent=function(b){a.send("Event",b,!1)},a.sendTiming=function(b){a.send("Timing",b,!1)},a.sendCounter=function(b){a.send("Counter",b,!1)},a.sendQuality=function(b){a.send("Quality",b,!1)},a.sendException=function(b){a.send("Exception",b,!1)},a.startTimeTrace=function(a,c){return b.startTimeTrace(a,c)},a.stopTimeTrace=function(a){return b.stopTimeTrace(a)},a.sendTimeTrace=function(a){b.sendTimeTrace(a)},a.send=function(c,d,e){b.save(c,d),(a.conf.noCache||e)&&b.send()},a.sendImmediately=function(){b.send()},a.close=function(){b.send()}}();
